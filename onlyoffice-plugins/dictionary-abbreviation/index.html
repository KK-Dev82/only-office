<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Dictionary & Abbreviation</title>
    <!-- IMPORTANT:
      - We MUST load `plugins.js` for the plugin bridge (`Asc.plugin.executeMethod`, `callCommand`, InputHelper).
      - We intentionally do NOT load `plugins-ui.js/plugins.css` because those have caused panel UI distortion in some builds.
    -->
    <script type="text/javascript" src="https://onlyoffice.github.io/sdkjs-plugins/v1/plugins.js"></script>

    <!-- own core files for independent development -->
    <link rel="stylesheet" href="core/styles.css?v=0.1.26" />
    <script>
      // Early crash overlay (shows inside the plugin panel even if other JS fails)
      (function () {
        var buf = (window.__DA_BOOT_ERRORS__ = window.__DA_BOOT_ERRORS__ || []);
        function push(msg) {
          try { buf.push(String(msg || "")); } catch (e0) {}
          try {
            var el = document.getElementById("daFlowMarker") || document.getElementById("daBootMarker");
            if (el) el.textContent = "DA error: " + String(msg || "").slice(0, 180);
          } catch (e1) {}
          try {
            var st = document.getElementById("status");
            if (st) st.textContent = "error";
          } catch (e2) {}
        }
        window.addEventListener("error", function (e) {
          try { push((e && (e.message || e.error)) ? (e.message || String(e.error)) : "window.error"); } catch (e0) {}
        });
        window.addEventListener("unhandledrejection", function (e) {
          try { push("unhandledrejection: " + String((e && e.reason) || "")); } catch (e0) {}
        });
        document.addEventListener("DOMContentLoaded", function () {
          try {
            if (!buf.length) return;
            var el = document.getElementById("daFlowMarker") || document.getElementById("daBootMarker");
            if (el) el.textContent = "DA errors: " + buf.slice(0, 3).join(" | ").slice(0, 220);
          } catch (e0) {}
        });
      })();
    </script>
    <script type="text/javascript" src="core/ns.js?v=0.1.26"></script>
    <script type="text/javascript" src="core/util.js?v=0.1.26"></script>
    <script type="text/javascript" src="core/telemetry.js?v=0.1.26"></script>
    <script type="text/javascript" src="core/storage.js?v=0.1.26"></script>
    <script type="text/javascript" src="core/editor.js?v=0.1.26"></script>
    <script type="text/javascript" src="core/bus.js?v=0.1.26"></script>
    <script type="text/javascript" src="core/uiwatch.js?v=0.1.26"></script>
    <script type="text/javascript" src="core/tabs.js?v=0.1.26"></script>
    <script type="text/javascript" src="core/debug.js?v=0.1.26"></script>
    <script type="text/javascript" src="features/dictionary.js?v=0.1.26"></script>
    <script type="text/javascript" src="features/abbreviation.js?v=0.1.26"></script>
    <script type="text/javascript" src="inputhelper.js?v=0.1.26"></script>

    <script type="text/javascript" src="bootstrap.js?v=0.1.26"></script>
  </head>
  <body>
    <!-- Fallback marker: if you see this, HTML loaded but CSS/JS may be blocked -->
    <div id="daBootMarker" style="position:fixed;left:6px;bottom:6px;z-index:2147483647;background:rgba(0,0,0,0.55);color:#fff;font:12px system-ui;padding:2px 6px;border-radius:6px;pointer-events:none;">
      DA boot (0.1.26)
    </div>
    <!-- Flow marker: visible even if fixed positioning breaks -->
    <div id="daFlowMarker" style="padding:6px 10px;font:12px system-ui;color:#111; background:#fff; border-bottom:1px dashed #ddd;">
      DA flow marker (0.1.26)
    </div>
    <!-- Focus trap: used to capture Arrow/Tab/Enter for suggestions (panel-only mode) -->
    <div id="doFocusTrap" tabindex="-1" aria-hidden="true" style="position:absolute;left:-9999px;top:-9999px;width:1px;height:1px;overflow:hidden;"></div>
    <div class="doRoot">
      <header class="doHeader">
        <div class="doHeaderLeft">
          <div class="doTitle">Language Tools</div>
          <div class="doBadges">
            <span class="doBadge" id="pluginVersion">v?</span>
          </div>
        </div>
        <div class="doHeaderRight">
          <div class="doStatus" id="status">loading‚Ä¶</div>
          <button class="doBtnGhost" id="toggleDebug" type="button">Debug</button>
        </div>
      </header>

      <div class="doTabsScroll" role="tablist" aria-label="Language tools tabs">
        <button class="doTabBtn doIsActive" id="tabBtn-dictionary" type="button" data-tab="dictionary">
          üìö Dictionary
        </button>
        <button class="doTabBtn" id="tabBtn-abbreviation" type="button" data-tab="abbreviation">
          üìù ‡∏Ñ‡∏≥‡∏¢‡πà‡∏≠
        </button>
      </div>

      <main class="doMain">
        <section class="doTabPanel doIsActive" id="tab-dictionary" data-tab="dictionary">
          <div class="doPanelHeader">
            <div class="doPanelTitle">üìö Dictionary</div>
            <div class="doPanelActions">
              <button id="dictToggleAdd" type="button">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏≥</button>
            </div>
          </div>

          <div class="doRow">
            <input id="dictQuery" class="doInput" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡∏≥‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤..." />
            <button id="dictSearch" type="button">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</button>
          </div>

          <div class="doCard doIsHidden" id="dictAddCard">
            <div class="doSubtitle">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏≥‡πÉ‡∏´‡∏°‡πà (Local)</div>
            <div class="doRow">
              <input id="dictNewWord" class="doInput" placeholder="‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå" />
              <input id="dictNewDesc" class="doInput" placeholder="‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)" />
              <button id="dictAdd" type="button">‡πÄ‡∏û‡∏¥‡πà‡∏°</button>
            </div>
          </div>

          <div class="doSplit2">
            <div class="doCard">
              <div class="doSubtitle">‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</div>
              <div id="dictResults" class="doList"></div>
            </div>
            <div class="doCard">
              <div class="doSubtitle">‡∏Ñ‡∏≥‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ (Local)</div>
              <div id="dictSavedList" class="doList"></div>
            </div>
          </div>
        </section>

        <section class="doTabPanel" id="tab-abbreviation" data-tab="abbreviation">
          <div class="doPanelHeader">
            <div class="doPanelTitle">üìù ‡∏Ñ‡∏≥‡∏¢‡πà‡∏≠</div>
            <div class="doPanelActions">
              <button id="abbrExpandSelection" type="button">Expand selection</button>
            </div>
          </div>

          <div class="doRow">
            <input id="abbrShort" class="doInput" placeholder="‡∏Ñ‡∏≥‡∏¢‡πà‡∏≠" />
            <input id="abbrFull" class="doInput" placeholder="‡∏Ñ‡∏≥‡πÄ‡∏ï‡πá‡∏°" />
            <button id="abbrAdd" type="button">‡πÄ‡∏û‡∏¥‡πà‡∏°</button>
          </div>

          <div class="doCard">
            <div class="doSubtitle">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏¢‡πà‡∏≠</div>
            <div id="abbrList" class="doList"></div>
          </div>
        </section>

        <section class="doDebugPanel doIsHidden" id="debugPanel">
          <div class="doPanelHeader">
            <div class="doPanelTitle">Debug</div>
            <div class="doPanelActions">
              <button id="btnGetSelection" type="button">Get selection</button>
              <button id="btnGetContext" type="button">Get context</button>
              <button id="btnInsertDemo" type="button">Insert demo</button>
            </div>
          </div>
          <pre class="doOutput" id="output"></pre>
        </section>
      </main>
    </div>
  </body>
</html>

